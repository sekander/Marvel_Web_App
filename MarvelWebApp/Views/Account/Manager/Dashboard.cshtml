@{
    ViewData["Title"] = "Manager - Comic Manager";
}

<h2>@ViewData["Title"]</h2>

<!-- Form to Add a Comic -->
<h3>Add New Comic</h3>
<form id="addComicForm" onsubmit="addComic(event)">
    <input type="text" id="title" placeholder="Title" required />
    <input type="number" id="quantity" placeholder="Quantity" required />
    <button type="submit">Add Comic</button>
</form>

<hr />

<!-- Get Comic By ID -->
<h3>Get Comic By ID</h3>
<input type="number" id="comicIdInput" placeholder="Comic ID" />
<button onclick="getComicById()">Fetch Comic</button>
<p id="comicDetails"></p>

<hr />

<!-- Table for Comics -->
<h3>Comic Inventory</h3>
<button onclick="loadComics()">Load Comics</button>
<table border="1" id="comicTable">
    <thead>
        <tr>
            <th>ID</th><th>Title</th><th>Quantity</th><th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    async function addComic(event) {
        event.preventDefault();
        const comic = {
            title: document.getElementById("title").value,
            quantity: parseInt(document.getElementById("quantity").value)
        };

        const res = await fetch('/api/manager/comics', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(comic)
        });

        const data = await res.json();
        alert(data.message);
        loadComics();
    }

    async function loadComics() {
        const res = await fetch('/api/manager');
        const comics = await res.json();
        const tbody = document.querySelector("#comicTable tbody");
        tbody.innerHTML = '';

        comics.forEach(c => {
            tbody.innerHTML += `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.title}</td>
                    <td><input type="number" value="${c.quantity}" id="qty-${c.id}" /></td>
                    <td>
                        <button onclick="updateQuantity(${c.id})">Update</button>
                        <button onclick="deleteComic(${c.id})">Delete</button>
                    </td>
                </tr>`;
        });
    }

    async function updateQuantity(id) {
        const quantity = parseInt(document.getElementById(`qty-${id}`).value);

        const res = await fetch(`/api/manager/comic/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(quantity)
        });

        const data = await res.json();
        alert(data.message);
    }

    async function deleteComic(id) {
        if (!confirm("Are you sure you want to delete this comic?")) return;

        const res = await fetch(`/api/manager/comics/${id}`, {
            method: 'DELETE'
        });

        const data = await res.json();
        alert(data.message);
        loadComics();
    }

    async function getComicById() {
        const id = document.getElementById("comicIdInput").value;
        const res = await fetch(`/api/manager/comic/${id}`);
        const data = await res.json();

        if (res.ok) {
            const comic = data.comic;
            document.getElementById("comicDetails").textContent = 
                `ID: ${comic.id}, Title: ${comic.title}, Quantity: ${comic.quantity}`;
        } else {
            document.getElementById("comicDetails").textContent = data.message;
        }
    }
</script>
